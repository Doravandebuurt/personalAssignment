@startuml CompressionMachine

title Continuous Compression Machine with Extrusion Feedback

start
:Idle;

if ("Start signal AND Extrusion Ready?") then (yes)
  :Enter RUN mode;

  fork
    :Continuous MOVE motion;
    repeat
      if ("Material Flow Sensor OK?") then (yes)
        :Maintain conveyor speed;
      else (no)
        :Slow down / stop conveyor;
      endif
    repeat while (RUN mode)
  fork again
    :Continuous PRESS motion;
    repeat
      if ("Thickness Sensor in range?") then (yes)
        :Keep press force constant;
      else (no)
        :Adjust press force;
      endif
    repeat while (RUN mode)
  fork again
    :Feedback from Extruder;
    repeat
      if ("Extruder Output HIGH?") then (yes)
        :Increase compression speed;
      else
        :Decrease compression speed;
      endif
    repeat while (RUN mode)
  end fork

  :Stop condition? (No material / alarm / stop button);

  :Exit RUN mode;
  :Go to Idle;

else (no)
  :Remain Idle;
endif

stop

@enduml
